package com.trustmubaiwa.dvtweatherproject.common

import com.google.gson.Gson
import com.trustmubaiwa.dvtweatherproject.services.models.CurrentWeatherResponse
import com.trustmubaiwa.dvtweatherproject.services.models.ForecastWeatherResponse
import junit.framework.TestCase
import org.junit.Test

class ExtensionFunctionKtTest : TestCase() {


    @Test
    fun `test mapForecastWeatherData should return a list of forecast weather model list`() {
        val response = getForecastResponse()
        val result = response.mapForecastWeatherData()

        assertNotNull(result)
        assertEquals(40, result.size)

        val firstResult = result.first()

        assertEquals(-25.9721, firstResult.latitude)
        assertEquals(28.1215, firstResult.longitude)
        assertEquals("Clouds", firstResult.main)
        assertEquals("Erand", firstResult.name)
        assertEquals("02n", firstResult.icon)
        assertEquals(1628553600, firstResult.dt)
        assertEquals("2021-08-10 00:00:00", firstResult.dateTxt)
    }

    @Test
    fun `test mapForecastWeatherData should return empty list if weather list is null`() {
        val response = getForecastResponse()
        response.list = null
        val result = response.mapForecastWeatherData()

        assertTrue(result.isEmpty())
    }

    @Test
    fun `test mapDailyWeatherData should return a day weather model object`() {
        val response = getCurrentWeatherResponse()
        val result = response.mapDailyWeatherData()

        assertEquals(27.9483, result?.longitude)
        assertEquals(26.3008, result?.latitude)
        assertEquals("01n", result?.icon)
        assertEquals("Clear", result?.main)
        assertEquals("clear sky", result?.description)
        assertEquals("EG", result?.country)
        assertEquals("28°", result?.temp)
        assertEquals("28°", result?.tempMin)
        assertEquals("28°", result?.tempMax)
        assertEquals(26, result?.humidity)
        assertEquals(5.29, result?.windSpeed)
    }

    @Test
    fun `test toWeekDay should return a weeks day from a date time int`() {
        val result = 1627155207.toWeekDay()
        assertEquals("Saturday", result)
    }

    @Test
    fun `test kelvinToCelsius should convert kelvins to celsius`() {
        val result = 301.83.kelvinToCelsius()
        assertEquals(28, result)
    }

    private fun getCurrentWeatherResponse(): CurrentWeatherResponse {
        val responseString =
            """{"coord":{"lon":27.9483,"lat":26.3008},"weather":[{"id":800,"main":"Clear","description":"clear sky","icon":"01n"}],"base":"stations","main":{"temp":301.83,"feels_like":300.57,"temp_min":301.83,"temp_max":301.83,"pressure":1009,"humidity":26,"sea_level":1009,"grnd_level":967},"visibility":10000,"wind":{"speed":5.29,"deg":5,"gust":9.63},"clouds":{"all":0},"dt":1627155207,"sys":{"country":"EG","sunrise":1627097367,"sunset":1627145979},"timezone":7200,"id":350661,"name":"Qaşr al Farāfirah","cod":200}"""
        return Gson().fromJson(responseString, CurrentWeatherResponse::class.java)
    }

    private fun getForecastResponse(): ForecastWeatherResponse {
        val responseString =
            """{"cod":"200","message":0,"cnt":40,"list":[{"dt":1628553600,"main":{"temp":283.79,"feels_like":281.69,"temp_min":283.79,"temp_max":285.32,"pressure":1023,"sea_level":1023,"grnd_level":852,"humidity":30,"temp_kf":-1.53},"weather":[{"id":801,"main":"Clouds","description":"few clouds","icon":"02n"}],"clouds":{"all":15},"wind":{"speed":3.86,"deg":174,"gust":7.4},"visibility":10000,"pop":0,"sys":{"pod":"n"},"dt_txt":"2021-08-10 00:00:00"},{"dt":1628564400,"main":{"temp":283.28,"feels_like":281.26,"temp_min":283.28,"temp_max":283.4,"pressure":1023,"sea_level":1023,"grnd_level":851,"humidity":35,"temp_kf":-0.12},"weather":[{"id":802,"main":"Clouds","description":"scattered clouds","icon":"03n"}],"clouds":{"all":27},"wind":{"speed":4.79,"deg":165,"gust":9.85},"visibility":10000,"pop":0,"sys":{"pod":"n"},"dt_txt":"2021-08-10 03:00:00"},{"dt":1628575200,"main":{"temp":283.23,"feels_like":281.73,"temp_min":283.23,"temp_max":283.23,"pressure":1025,"sea_level":1025,"grnd_level":853,"humidity":55,"temp_kf":0},"weather":[{"id":801,"main":"Clouds","description":"few clouds","icon":"02d"}],"clouds":{"all":20},"wind":{"speed":5.63,"deg":122,"gust":8.92},"visibility":10000,"pop":0,"sys":{"pod":"d"},"dt_txt":"2021-08-10 06:00:00"},{"dt":1628586000,"main":{"temp":288.87,"feels_like":287.52,"temp_min":288.87,"temp_max":288.87,"pressure":1025,"sea_level":1025,"grnd_level":855,"humidity":39,"temp_kf":0},"weather":[{"id":800,"main":"Clear","description":"clear sky","icon":"01d"}],"clouds":{"all":5},"wind":{"speed":4.95,"deg":78,"gust":5.41},"visibility":10000,"pop":0,"sys":{"pod":"d"},"dt_txt":"2021-08-10 09:00:00"},{"dt":1628596800,"main":{"temp":291.42,"feels_like":290.16,"temp_min":291.42,"temp_max":291.42,"pressure":1022,"sea_level":1022,"grnd_level":854,"humidity":33,"temp_kf":0},"weather":[{"id":800,"main":"Clear","description":"clear sky","icon":"01d"}],"clouds":{"all":5},"wind":{"speed":4.71,"deg":17,"gust":4.92},"visibility":10000,"pop":0,"sys":{"pod":"d"},"dt_txt":"2021-08-10 12:00:00"},{"dt":1628607600,"main":{"temp":291.05,"feels_like":289.65,"temp_min":291.05,"temp_max":291.05,"pressure":1022,"sea_level":1022,"grnd_level":854,"humidity":29,"temp_kf":0},"weather":[{"id":801,"main":"Clouds","description":"few clouds","icon":"02d"}],"clouds":{"all":14},"wind":{"speed":3.31,"deg":19,"gust":4.32},"visibility":10000,"pop":0,"sys":{"pod":"d"},"dt_txt":"2021-08-10 15:00:00"},{"dt":1628618400,"main":{"temp":287.09,"feels_like":285.77,"temp_min":287.09,"temp_max":287.09,"pressure":1025,"sea_level":1025,"grnd_level":855,"humidity":47,"temp_kf":0},"weather":[{"id":800,"main":"Clear","description":"clear sky","icon":"01n"}],"clouds":{"all":8},"wind":{"speed":4.9,"deg":29,"gust":8.85},"visibility":10000,"pop":0,"sys":{"pod":"n"},"dt_txt":"2021-08-10 18:00:00"},{"dt":1628629200,"main":{"temp":284.03,"feels_like":282.77,"temp_min":284.03,"temp_max":284.03,"pressure":1026,"sea_level":1026,"grnd_level":854,"humidity":61,"temp_kf":0},"weather":[{"id":802,"main":"Clouds","description":"scattered clouds","icon":"03n"}],"clouds":{"all":25},"wind":{"speed":5.57,"deg":29,"gust":10.96},"visibility":10000,"pop":0,"sys":{"pod":"n"},"dt_txt":"2021-08-10 21:00:00"},{"dt":1628640000,"main":{"temp":282.09,"feels_like":279.97,"temp_min":282.09,"temp_max":282.09,"pressure":1026,"sea_level":1026,"grnd_level":853,"humidity":70,"temp_kf":0},"weather":[{"id":803,"main":"Clouds","description":"broken clouds","icon":"04n"}],"clouds":{"all":57},"wind":{"speed":3.76,"deg":19,"gust":7.57},"visibility":10000,"pop":0,"sys":{"pod":"n"},"dt_txt":"2021-08-11 00:00:00"},{"dt":1628650800,"main":{"temp":280.65,"feels_like":278.61,"temp_min":280.65,"temp_max":280.65,"pressure":1025,"sea_level":1025,"grnd_level":851,"humidity":79,"temp_kf":0},"weather":[{"id":802,"main":"Clouds","description":"scattered clouds","icon":"03n"}],"clouds":{"all":36},"wind":{"speed":3.07,"deg":10,"gust":5.56},"visibility":10000,"pop":0,"sys":{"pod":"n"},"dt_txt":"2021-08-11 03:00:00"},{"dt":1628661600,"main":{"temp":281.61,"feels_like":279.91,"temp_min":281.61,"temp_max":281.61,"pressure":1026,"sea_level":1026,"grnd_level":852,"humidity":74,"temp_kf":0},"weather":[{"id":802,"main":"Clouds","description":"scattered clouds","icon":"03d"}],"clouds":{"all":34},"wind":{"speed":2.85,"deg":359,"gust":5.41},"visibility":10000,"pop":0,"sys":{"pod":"d"},"dt_txt":"2021-08-11 06:00:00"},{"dt":1628672400,"main":{"temp":287.07,"feels_like":285.8,"temp_min":287.07,"temp_max":287.07,"pressure":1023,"sea_level":1023,"grnd_level":853,"humidity":49,"temp_kf":0},"weather":[{"id":803,"main":"Clouds","description":"broken clouds","icon":"04d"}],"clouds":{"all":78},"wind":{"speed":4.81,"deg":346,"gust":6.41},"visibility":10000,"pop":0,"sys":{"pod":"d"},"dt_txt":"2021-08-11 09:00:00"},{"dt":1628683200,"main":{"temp":290.65,"feels_like":289.4,"temp_min":290.65,"temp_max":290.65,"pressure":1019,"sea_level":1019,"grnd_level":852,"humidity":36,"temp_kf":0},"weather":[{"id":803,"main":"Clouds","description":"broken clouds","icon":"04d"}],"clouds":{"all":66},"wind":{"speed":4.95,"deg":313,"gust":6.27},"visibility":10000,"pop":0,"sys":{"pod":"d"},"dt_txt":"2021-08-11 12:00:00"},{"dt":1628694000,"main":{"temp":290.42,"feels_like":289.14,"temp_min":290.42,"temp_max":290.42,"pressure":1018,"sea_level":1018,"grnd_level":851,"humidity":36,"temp_kf":0},"weather":[{"id":804,"main":"Clouds","description":"overcast clouds","icon":"04d"}],"clouds":{"all":100},"wind":{"speed":3.81,"deg":297,"gust":5.55},"visibility":10000,"pop":0,"sys":{"pod":"d"},"dt_txt":"2021-08-11 15:00:00"},{"dt":1628704800,"main":{"temp":287.97,"feels_like":286.63,"temp_min":287.97,"temp_max":287.97,"pressure":1020,"sea_level":1020,"grnd_level":851,"humidity":43,"temp_kf":0},"weather":[{"id":804,"main":"Clouds","description":"overcast clouds","icon":"04n"}],"clouds":{"all":100},"wind":{"speed":2.8,"deg":313,"gust":6.15},"visibility":10000,"pop":0,"sys":{"pod":"n"},"dt_txt":"2021-08-11 18:00:00"},{"dt":1628715600,"main":{"temp":286.45,"feels_like":285.12,"temp_min":286.45,"temp_max":286.45,"pressure":1020,"sea_level":1020,"grnd_level":850,"humidity":49,"temp_kf":0},"weather":[{"id":804,"main":"Clouds","description":"overcast clouds","icon":"04n"}],"clouds":{"all":100},"wind":{"speed":2.05,"deg":313,"gust":5.6},"visibility":10000,"pop":0,"sys":{"pod":"n"},"dt_txt":"2021-08-11 21:00:00"},{"dt":1628726400,"main":{"temp":285.14,"feels_like":283.78,"temp_min":285.14,"temp_max":285.14,"pressure":1019,"sea_level":1019,"grnd_level":848,"humidity":53,"temp_kf":0},"weather":[{"id":803,"main":"Clouds","description":"broken clouds","icon":"04n"}],"clouds":{"all":57},"wind":{"speed":1.99,"deg":329,"gust":5.13},"visibility":10000,"pop":0,"sys":{"pod":"n"},"dt_txt":"2021-08-12 00:00:00"},{"dt":1628737200,"main":{"temp":284,"feels_like":282.66,"temp_min":284,"temp_max":284,"pressure":1019,"sea_level":1019,"grnd_level":848,"humidity":58,"temp_kf":0},"weather":[{"id":800,"main":"Clear","description":"clear sky","icon":"01n"}],"clouds":{"all":3},"wind":{"speed":1.75,"deg":337,"gust":5.2},"visibility":10000,"pop":0,"sys":{"pod":"n"},"dt_txt":"2021-08-12 03:00:00"},{"dt":1628748000,"main":{"temp":285.77,"feels_like":284.45,"temp_min":285.77,"temp_max":285.77,"pressure":1020,"sea_level":1020,"grnd_level":850,"humidity":52,"temp_kf":0},"weather":[{"id":800,"main":"Clear","description":"clear sky","icon":"01d"}],"clouds":{"all":1},"wind":{"speed":2.06,"deg":328,"gust":6.82},"visibility":10000,"pop":0,"sys":{"pod":"d"},"dt_txt":"2021-08-12 06:00:00"},{"dt":1628758800,"main":{"temp":292.21,"feels_like":291.03,"temp_min":292.21,"temp_max":292.21,"pressure":1019,"sea_level":1019,"grnd_level":852,"humidity":33,"temp_kf":0},"weather":[{"id":800,"main":"Clear","description":"clear sky","icon":"01d"}],"clouds":{"all":2},"wind":{"speed":5.74,"deg":319,"gust":8.38},"visibility":10000,"pop":0,"sys":{"pod":"d"},"dt_txt":"2021-08-12 09:00:00"},{"dt":1628769600,"main":{"temp":295.21,"feels_like":294.1,"temp_min":295.21,"temp_max":295.21,"pressure":1015,"sea_level":1015,"grnd_level":851,"humidity":24,"temp_kf":0},"weather":[{"id":801,"main":"Clouds","description":"few clouds","icon":"02d"}],"clouds":{"all":20},"wind":{"speed":6.19,"deg":310,"gust":9.11},"visibility":10000,"pop":0,"sys":{"pod":"d"},"dt_txt":"2021-08-12 12:00:00"},{"dt":1628780400,"main":{"temp":294.99,"feels_like":293.8,"temp_min":294.99,"temp_max":294.99,"pressure":1015,"sea_level":1015,"grnd_level":850,"humidity":22,"temp_kf":0},"weather":[{"id":803,"main":"Clouds","description":"broken clouds","icon":"04d"}],"clouds":{"all":74},"wind":{"speed":5.2,"deg":302,"gust":7.76},"visibility":10000,"pop":0,"sys":{"pod":"d"},"dt_txt":"2021-08-12 15:00:00"},{"dt":1628791200,"main":{"temp":290.64,"feels_like":289.2,"temp_min":290.64,"temp_max":290.64,"pressure":1017,"sea_level":1017,"grnd_level":850,"humidity":29,"temp_kf":0},"weather":[{"id":803,"main":"Clouds","description":"broken clouds","icon":"04n"}],"clouds":{"all":74},"wind":{"speed":1.28,"deg":350,"gust":1.84},"visibility":10000,"pop":0,"sys":{"pod":"n"},"dt_txt":"2021-08-12 18:00:00"},{"dt":1628802000,"main":{"temp":289.24,"feels_like":287.74,"temp_min":289.24,"temp_max":289.24,"pressure":1018,"sea_level":1018,"grnd_level":850,"humidity":32,"temp_kf":0},"weather":[{"id":800,"main":"Clear","description":"clear sky","icon":"01n"}],"clouds":{"all":5},"wind":{"speed":0.56,"deg":333,"gust":0.77},"visibility":10000,"pop":0,"sys":{"pod":"n"},"dt_txt":"2021-08-12 21:00:00"},{"dt":1628812800,"main":{"temp":287.7,"feels_like":286.1,"temp_min":287.7,"temp_max":287.7,"pressure":1018,"sea_level":1018,"grnd_level":849,"humidity":34,"temp_kf":0},"weather":[{"id":800,"main":"Clear","description":"clear sky","icon":"01n"}],"clouds":{"all":4},"wind":{"speed":0.65,"deg":86,"gust":0.99},"visibility":10000,"pop":0,"sys":{"pod":"n"},"dt_txt":"2021-08-13 00:00:00"},{"dt":1628823600,"main":{"temp":286.83,"feels_like":285.17,"temp_min":286.83,"temp_max":286.83,"pressure":1019,"sea_level":1019,"grnd_level":850,"humidity":35,"temp_kf":0},"weather":[{"id":800,"main":"Clear","description":"clear sky","icon":"01n"}],"clouds":{"all":2},"wind":{"speed":1.99,"deg":77,"gust":1.95},"visibility":10000,"pop":0,"sys":{"pod":"n"},"dt_txt":"2021-08-13 03:00:00"},{"dt":1628834400,"main":{"temp":284.82,"feels_like":283.79,"temp_min":284.82,"temp_max":284.82,"pressure":1024,"sea_level":1024,"grnd_level":852,"humidity":67,"temp_kf":0},"weather":[{"id":800,"main":"Clear","description":"clear sky","icon":"01d"}],"clouds":{"all":3},"wind":{"speed":6.74,"deg":101,"gust":11.97},"visibility":10000,"pop":0,"sys":{"pod":"d"},"dt_txt":"2021-08-13 06:00:00"},{"dt":1628845200,"main":{"temp":291.27,"feels_like":290.13,"temp_min":291.27,"temp_max":291.27,"pressure":1023,"sea_level":1023,"grnd_level":855,"humidity":38,"temp_kf":0},"weather":[{"id":800,"main":"Clear","description":"clear sky","icon":"01d"}],"clouds":{"all":2},"wind":{"speed":7.15,"deg":65,"gust":8.56},"visibility":10000,"pop":0,"sys":{"pod":"d"},"dt_txt":"2021-08-13 09:00:00"},{"dt":1628856000,"main":{"temp":294.09,"feels_like":292.97,"temp_min":294.09,"temp_max":294.09,"pressure":1020,"sea_level":1020,"grnd_level":854,"humidity":28,"temp_kf":0},"weather":[{"id":800,"main":"Clear","description":"clear sky","icon":"01d"}],"clouds":{"all":2},"wind":{"speed":7.84,"deg":35,"gust":9.32},"visibility":10000,"pop":0,"sys":{"pod":"d"},"dt_txt":"2021-08-13 12:00:00"},{"dt":1628866800,"main":{"temp":286.17,"feels_like":285.09,"temp_min":286.17,"temp_max":286.17,"pressure":1025,"sea_level":1025,"grnd_level":854,"humidity":60,"temp_kf":0},"weather":[{"id":802,"main":"Clouds","description":"scattered clouds","icon":"03d"}],"clouds":{"all":44},"wind":{"speed":9.11,"deg":84,"gust":12.97},"visibility":10000,"pop":0.06,"sys":{"pod":"d"},"dt_txt":"2021-08-13 15:00:00"},{"dt":1628877600,"main":{"temp":283.51,"feels_like":282.4,"temp_min":283.51,"temp_max":283.51,"pressure":1028,"sea_level":1028,"grnd_level":855,"humidity":69,"temp_kf":0},"weather":[{"id":803,"main":"Clouds","description":"broken clouds","icon":"04n"}],"clouds":{"all":66},"wind":{"speed":9.09,"deg":76,"gust":14.86},"visibility":10000,"pop":0,"sys":{"pod":"n"},"dt_txt":"2021-08-13 18:00:00"},{"dt":1628888400,"main":{"temp":282.16,"feels_like":278.48,"temp_min":282.16,"temp_max":282.16,"pressure":1029,"sea_level":1029,"grnd_level":855,"humidity":71,"temp_kf":0},"weather":[{"id":804,"main":"Clouds","description":"overcast clouds","icon":"04n"}],"clouds":{"all":85},"wind":{"speed":8.22,"deg":72,"gust":14.2},"visibility":10000,"pop":0,"sys":{"pod":"n"},"dt_txt":"2021-08-13 21:00:00"},{"dt":1628899200,"main":{"temp":282.03,"feels_like":278.65,"temp_min":282.03,"temp_max":282.03,"pressure":1028,"sea_level":1028,"grnd_level":854,"humidity":71,"temp_kf":0},"weather":[{"id":804,"main":"Clouds","description":"overcast clouds","icon":"04d"}],"clouds":{"all":91},"wind":{"speed":7,"deg":71,"gust":13.77},"visibility":10000,"pop":0,"sys":{"pod":"d"},"dt_txt":"2021-08-14 00:00:00"},{"dt":1628910000,"main":{"temp":280.68,"feels_like":276.97,"temp_min":280.68,"temp_max":280.68,"pressure":1027,"sea_level":1027,"grnd_level":853,"humidity":76,"temp_kf":0},"weather":[{"id":803,"main":"Clouds","description":"broken clouds","icon":"04d"}],"clouds":{"all":60},"wind":{"speed":6.83,"deg":64,"gust":15.01},"visibility":10000,"pop":0,"sys":{"pod":"d"},"dt_txt":"2021-08-14 03:00:00"},{"dt":1628920800,"main":{"temp":281.54,"feels_like":278.02,"temp_min":281.54,"temp_max":281.54,"pressure":1028,"sea_level":1028,"grnd_level":854,"humidity":73,"temp_kf":0},"weather":[{"id":802,"main":"Clouds","description":"scattered clouds","icon":"03d"}],"clouds":{"all":33},"wind":{"speed":7.01,"deg":42,"gust":15.93},"visibility":10000,"pop":0,"sys":{"pod":"d"},"dt_txt":"2021-08-14 06:00:00"},{"dt":1628931600,"main":{"temp":285.66,"feels_like":284.51,"temp_min":285.66,"temp_max":285.66,"pressure":1027,"sea_level":1027,"grnd_level":855,"humidity":59,"temp_kf":0},"weather":[{"id":803,"main":"Clouds","description":"broken clouds","icon":"04d"}],"clouds":{"all":64},"wind":{"speed":8.89,"deg":22,"gust":13.34},"visibility":10000,"pop":0,"sys":{"pod":"d"},"dt_txt":"2021-08-14 09:00:00"},{"dt":1628942400,"main":{"temp":288.54,"feels_like":287.44,"temp_min":288.54,"temp_max":288.54,"pressure":1022,"sea_level":1022,"grnd_level":853,"humidity":50,"temp_kf":0},"weather":[{"id":803,"main":"Clouds","description":"broken clouds","icon":"04d"}],"clouds":{"all":77},"wind":{"speed":8.64,"deg":14,"gust":13.85},"visibility":10000,"pop":0,"sys":{"pod":"d"},"dt_txt":"2021-08-14 12:00:00"},{"dt":1628953200,"main":{"temp":289.04,"feels_like":287.96,"temp_min":289.04,"temp_max":289.04,"pressure":1022,"sea_level":1022,"grnd_level":853,"humidity":49,"temp_kf":0},"weather":[{"id":804,"main":"Clouds","description":"overcast clouds","icon":"04d"}],"clouds":{"all":100},"wind":{"speed":6.95,"deg":356,"gust":11.25},"visibility":10000,"pop":0,"sys":{"pod":"d"},"dt_txt":"2021-08-14 15:00:00"},{"dt":1628964000,"main":{"temp":285.17,"feels_like":284.28,"temp_min":285.17,"temp_max":285.17,"pressure":1025,"sea_level":1025,"grnd_level":854,"humidity":71,"temp_kf":0},"weather":[{"id":500,"main":"Rain","description":"light rain","icon":"10d"}],"clouds":{"all":100},"wind":{"speed":6.64,"deg":26,"gust":10.76},"visibility":10000,"pop":0.24,"rain":{"3h":0.52},"sys":{"pod":"d"},"dt_txt":"2021-08-14 18:00:00"},{"dt":1628974800,"main":{"temp":282.82,"feels_like":280.06,"temp_min":282.82,"temp_max":282.82,"pressure":1026,"sea_level":1026,"grnd_level":853,"humidity":83,"temp_kf":0},"weather":[{"id":500,"main":"Rain","description":"light rain","icon":"10d"}],"clouds":{"all":98},"wind":{"speed":5.74,"deg":24,"gust":11.43},"visibility":10000,"pop":0.35,"rain":{"3h":0.11},"sys":{"pod":"d"},"dt_txt":"2021-08-14 21:00:00"}],"city":{"id":1005265,"name":"Erand","coord":{"lat":-25.9721,"lon":28.1215},"country":"ZA","population":0,"timezone":7200,"sunrise":1628484055,"sunset":1628523912}}"""
        return Gson().fromJson(responseString, ForecastWeatherResponse::class.java)
    }
}